
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pkgcore.fs.contents &#8212; pkgcore trunk documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pkgcore trunk documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pkgcore.fs.contents</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pkgcore.fs.contents</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">contents set- container of fs objects</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>

<span class="kn">from</span> <span class="nn">snakeoil.klass</span> <span class="kn">import</span> <span class="n">alias_method</span><span class="p">,</span> <span class="n">generic_equality</span>
<span class="kn">from</span> <span class="nn">snakeoil.osutils</span> <span class="kn">import</span> <span class="n">normpath</span><span class="p">,</span> <span class="n">pjoin</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">fs</span>


<div class="viewcode-block" id="change_offset_rewriter"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.change_offset_rewriter">[docs]</a><span class="k">def</span> <span class="nf">change_offset_rewriter</span><span class="p">(</span><span class="n">orig_offset</span><span class="p">,</span> <span class="n">new_offset</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="n">path_sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">offset_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_offset</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">path_sep</span><span class="p">))</span>
    <span class="c1"># localize it.</span>
    <span class="n">npf</span> <span class="o">=</span> <span class="n">normpath</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
        <span class="c1"># slip in the &#39;/&#39; default to force it to still generate a</span>
        <span class="c1"># full path still</span>
        <span class="k">yield</span> <span class="n">x</span><span class="o">.</span><span class="n">change_attributes</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">npf</span><span class="p">(</span><span class="n">pjoin</span><span class="p">(</span><span class="n">new_offset</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="n">offset_len</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">path_sep</span><span class="p">))))</span></div>

<span class="n">offset_rewriter</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">change_offset_rewriter</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="check_instance"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.check_instance">[docs]</a><span class="k">def</span> <span class="nf">check_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">fsBase</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">&#39; is not a fs.fsBase deriviative&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="contentsSet"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet">[docs]</a><span class="k">class</span> <span class="nc">contentsSet</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">generic_equality</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;set of :class:`pkgcore.fs.fs.fsBase` objects&quot;&quot;&quot;</span>
    <span class="n">__attr_comparison__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_dict&#39;</span><span class="p">,)</span>
    <span class="n">__dict_kls__</span> <span class="o">=</span> <span class="nb">dict</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param initial: initial fs objs for this set</span>
<span class="sd">        :type initial: sequence</span>
<span class="sd">        :param mutable: controls if it modifiable after initialization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict_kls__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">check_instance</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">initial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="n">mutable</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">([</span><span class="si">{</span><span class="n">contents</span><span class="si">}</span><span class="s1">])&#39;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="c1"># this should include the id among other things</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">([</span><span class="si">{</span><span class="n">contents</span><span class="si">}</span><span class="s1">])&#39;</span>

<div class="viewcode-block" id="contentsSet.add"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add a new fs obj to the set</span>

<span class="sd">        :param obj: must be a derivative of :obj:`pkgcore.fs.fs.fsBase`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="c1"># weird, but keeping with set.</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s1"> is frozen; no add functionality&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">&#39; is not a fs.fsBase class&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span></div>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove a fs obj to the set</span>

<span class="sd">        :type obj: a derivative of :obj:`pkgcore.fs.fs.fsBase`</span>
<span class="sd">            or a string location of an obj in the set.</span>
<span class="sd">        :raise KeyError: if the obj isn&#39;t found</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="c1"># weird, but keeping with set.</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s1"> is frozen; no remove functionality&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">normpath</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span>

<div class="viewcode-block" id="contentsSet.remove"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span></div>

<div class="viewcode-block" id="contentsSet.discard"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.discard">[docs]</a>    <span class="k">def</span> <span class="nf">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">normpath</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>
        <span class="k">return</span> <span class="n">normpath</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>

<div class="viewcode-block" id="contentsSet.clear"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        clear the set</span>
<span class="sd">        :raise ttributeError: if the instance is frozen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="c1"># weird, but keeping with set.</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s1"> is frozen; no clear functionality&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_loc</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">x</span><span class="o">.</span><span class="n">location</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">x</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_ensure_fsbase</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">isfs_obj</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;must be an fsBase derivative: got </span><span class="si">{</span><span class="n">x</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">x</span>

<div class="viewcode-block" id="contentsSet.difference"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.difference">[docs]</a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">contentsSet</span><span class="p">((</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">),</span>
            <span class="n">mutable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.difference_update"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.difference_update">[docs]</a>    <span class="k">def</span> <span class="nf">difference_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;immutable type </span><span class="si">{</span><span class="bp">self</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">rem</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.intersection"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.intersection">[docs]</a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">contentsSet</span><span class="p">((</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">),</span>
            <span class="n">mutable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.intersection_update"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.intersection_update">[docs]</a>    <span class="k">def</span> <span class="nf">intersection_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;immutable type </span><span class="si">{</span><span class="bp">self</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

        <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.issubset"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.issubset">[docs]</a>    <span class="k">def</span> <span class="nf">issubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">other</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.issuperset"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.issuperset">[docs]</a>    <span class="k">def</span> <span class="nf">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.isdisjoint"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.isdisjoint">[docs]</a>    <span class="k">def</span> <span class="nf">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_loc</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">other</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.union"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.union">[docs]</a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">contentsSet</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">)</span>

<div class="viewcode-block" id="contentsSet.symmetric_difference"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.symmetric_difference">[docs]</a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">contentsSet</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">symmetric_difference_update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;mutable&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="contentsSet.symmetric_difference_update"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.symmetric_difference_update">[docs]</a>    <span class="k">def</span> <span class="nf">symmetric_difference_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;immutable type </span><span class="si">{</span><span class="bp">self</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">contentsSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ensure_fsbase</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">rem</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">l</span><span class="p">,</span> <span class="n">rem</span></div>

<div class="viewcode-block" id="contentsSet.update"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span></div>

<div class="viewcode-block" id="contentsSet.iterfiles"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.iterfiles">[docs]</a>    <span class="k">def</span> <span class="nf">iterfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A generator yielding just :obj:`pkgcore.fs.fs.fsFile` instances.</span>

<span class="sd">        :param invert: if True, yield everything that isn&#39;t a fsFile instance,</span>
<span class="sd">            else yields just fsFile instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_reg</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;is_reg&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.files"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.files">[docs]</a>    <span class="k">def</span> <span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of just :obj:`pkgcore.fs.fs.fsFile` instances.</span>

<span class="sd">        :param invert: if True, yield everything that isn&#39;t a</span>
<span class="sd">            fsFile instance, else yields just fsFile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfiles</span><span class="p">(</span><span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">))</span></div>

<div class="viewcode-block" id="contentsSet.iterdirs"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.iterdirs">[docs]</a>    <span class="k">def</span> <span class="nf">iterdirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;is_dir&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.dirs"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.dirs">[docs]</a>    <span class="k">def</span> <span class="nf">dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterdirs</span><span class="p">(</span><span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">))</span></div>

<div class="viewcode-block" id="contentsSet.itersymlinks"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.itersymlinks">[docs]</a>    <span class="k">def</span> <span class="nf">itersymlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;is_sym&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.symlinks"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.symlinks">[docs]</a>    <span class="k">def</span> <span class="nf">symlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterlinks</span><span class="p">(</span><span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">))</span></div>

    <span class="n">iterlinks</span> <span class="o">=</span> <span class="n">alias_method</span><span class="p">(</span><span class="s1">&#39;itersymlinks&#39;</span><span class="p">)</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">alias_method</span><span class="p">(</span><span class="s1">&#39;symlinks&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="contentsSet.iterdevs"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.iterdevs">[docs]</a>    <span class="k">def</span> <span class="nf">iterdevs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dev</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;is_dev&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.devs"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.devs">[docs]</a>    <span class="k">def</span> <span class="nf">devs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterdevs</span><span class="p">(</span><span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">))</span></div>

<div class="viewcode-block" id="contentsSet.iterfifos"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.iterfifos">[docs]</a>    <span class="k">def</span> <span class="nf">iterfifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_fifo</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;is_fifo&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.fifos"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.fifos">[docs]</a>    <span class="k">def</span> <span class="nf">fifos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfifos</span><span class="p">(</span><span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">))</span></div>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">,</span> <span class="s1">&#39;symlink&#39;</span><span class="p">,</span> <span class="s1">&#39;dev&#39;</span><span class="p">,</span> <span class="s1">&#39;fifo&#39;</span><span class="p">):</span>
        <span class="nb">locals</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;iter</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> \
            <span class="n">iterfiles</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;fsFile&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;fs</span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">locals</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> \
            <span class="n">files</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;fsFile&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;fs</span><span class="si">{</span><span class="n">k</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">k</span>

<div class="viewcode-block" id="contentsSet.inode_map"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.inode_map">[docs]</a>    <span class="k">def</span> <span class="nf">inode_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterfiles</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dev</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">inode</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="contentsSet.clone"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([],</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="contentsSet.insert_offset"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.insert_offset">[docs]</a>    <span class="k">def</span> <span class="nf">insert_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="n">cset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cset</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">offset_rewriter</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cset</span></div>

<div class="viewcode-block" id="contentsSet.change_offset"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.change_offset">[docs]</a>    <span class="k">def</span> <span class="nf">change_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_offset</span><span class="p">,</span> <span class="n">new_offset</span><span class="p">):</span>
        <span class="n">cset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cset</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">change_offset_rewriter</span><span class="p">(</span><span class="n">old_offset</span><span class="p">,</span> <span class="n">new_offset</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cset</span></div>

<div class="viewcode-block" id="contentsSet.iter_child_nodes"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.iter_child_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">iter_child_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yield a stream of nodes that are fs entries contained within the</span>
<span class="sd">        passed in start point.</span>

<span class="sd">        :param start_point: fs filepath all yielded nodes must be within.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">fs</span><span class="o">.</span><span class="n">fsBase</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start_point</span><span class="o">.</span><span class="n">is_sym</span><span class="p">:</span>
                <span class="n">start_point</span> <span class="o">=</span> <span class="n">start_point</span><span class="o">.</span><span class="n">target</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start_point</span> <span class="o">=</span> <span class="n">start_point</span><span class="o">.</span><span class="n">location</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">cn_path</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">start_point</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
            <span class="c1"># what about sym targets?</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">cn_path</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">x</span></div>

<div class="viewcode-block" id="contentsSet.child_nodes"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.child_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">child_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a clone of this instance, w/ just the child nodes returned</span>
<span class="sd">        from `iter_child_nodes`.</span>

<span class="sd">        :param start_point: fs filepath all yielded nodes must be within.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">empty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_child_nodes</span><span class="p">(</span><span class="n">start_point</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="contentsSet.map_directory_structure"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.map_directory_structure">[docs]</a>    <span class="k">def</span> <span class="nf">map_directory_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">add_conflicting_sym</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resolve the directory structure between this instance, and another</span>
<span class="sd">        contentset, collapsing syms of self into directories of other.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conflicts_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">resolved_target</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">iterlinks</span><span class="p">()}</span>
        <span class="c1"># rebuild the targets first; sorted due to the fact that we want to</span>
        <span class="c1"># rewrite each node (resolving down the filepath chain)</span>
        <span class="n">conflicts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contentsSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterdirs</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">conflicts_d</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">conflicts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
                <span class="c1"># punt the conflict first, since we don&#39;t want it getting rewritten</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">conflict</span><span class="p">)</span>
                <span class="n">subset</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">child_nodes</span><span class="p">(</span><span class="n">conflict</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
                <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">change_offset</span><span class="p">(</span><span class="n">conflict</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">conflict</span><span class="o">.</span><span class="n">resolved_target</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">add_conflicting_sym</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="n">conflicts_d</span><span class="p">[</span><span class="n">conflict</span><span class="p">]])</span>

            <span class="c1"># rebuild the targets first; sorted due to the fact that we want to</span>
            <span class="c1"># rewrite each node (resolving down the filepath chain)</span>
            <span class="n">conflicts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contentsSet</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">iterdirs</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">conflicts_d</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="contentsSet.add_missing_directories"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.contentsSet.add_missing_directories">[docs]</a>    <span class="k">def</span> <span class="nf">add_missing_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mo">0o775</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mtime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that a directory node exists for each path; add if missing.&quot;&quot;&quot;</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dirname</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mtime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1"># have to go recursive since many directories may be missing.</span>
        <span class="n">missing_initial</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing_initial</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing</span> <span class="ow">and</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">missing</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">fsDir</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="n">gid</span><span class="p">,</span> <span class="n">mtime</span><span class="o">=</span><span class="n">mtime</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="OrderedContentsSet"><a class="viewcode-back" href="../../../api/pkgcore.fs.contents.html#pkgcore.fs.contents.OrderedContentsSet">[docs]</a><span class="k">class</span> <span class="nc">OrderedContentsSet</span><span class="p">(</span><span class="n">contentsSet</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">add_missing_directories</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">contentsSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">initial</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
        <span class="c1"># some sources are a bit stupid, tarballs for example.</span>
        <span class="c1"># add missing directories if requested</span>
        <span class="k">if</span> <span class="n">add_missing_directories</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_missing_directories</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="n">mutable</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pkgcore trunk documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pkgcore.fs.contents</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2019, pkgcore contributors.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>